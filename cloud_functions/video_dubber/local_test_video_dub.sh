#!/bin/bash
# Tests the initial call
#
# Copyright 2020 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

CONFIG_PATH="../../terraform/terraform.tfvars"
WORKSHEET_URL="https://docs.google.com/spreadsheets/d/XXXXXX"
PROJECT_ID="MYPROJECT"
PUBSUB_TOPIC="ariel-dub_video"

set -a
eval "$(cat ${CONFIG_PATH} | sed -e 's/ *= */=/g')"

curl localhost:8080   -X POST   -H "Content-Type: application/json"   -H "ce-id: 123451234512345"   -H "ce-specversion: 1.0"   -H "ce-time: 2020-01-02T12:34:56.789Z"   -H "ce-type: google.cloud.pubsub.topic.v1.messagePublished"  -H "ce-source: //pubsub.googleapis.com/projects/${PROJECT_ID}/topics/${PUBSUB_TOPIC}"  -d '{
    "message": {
          "data": "eyJ3b3Jrc2hlZXRfdXJsIjogImh0dHBzOi8vZG9jcy5nb29nbGUuY29tL3NwcmVhZHNoZWV0cy9kLzFQOGRCM2V4TndQS09DcE1sTmtEU1laVi16WlFFek1mODllNmU3MUdPYmdjIiwgImxpbmVfY29uZmlnIjogeyJjYW1wYWlnbl9uYW1lIjogInRlc3RfY2FtcGFpZ24iLCAiY3VzdG9tX3RhZyI6ICJtdWx0aV9zcGVha2VyX3NjcmlwdF9nb29nbGVfbXVsdGlfbGFuZ3VhZ2UiLCAib3JpZ2luYWxfbGFuZ3VhZ2UiOiAiZW4tVVMiLCAidGFyZ2V0X2xhbmd1YWdlIjogIltcImVuLVVTXCIsIFwiZW4tR0JcIiwgXCJlcy1FU1wiXSIsICJ2aWRlb191cmwiOiAibXktYXJpZWwtYnVja2V0L3NhbXBsZS9nbG92b2Jhc2V2aWRlby5tcDQiLCAic2NyaXB0IjogIltcbiAge1wic3RhcnRcIjogMC45LCBcImVuZFwiOiAyLjMsIFwidGV4dFwiOiBcIlBpenphIGxvdmVyP1wifSxcbiAge1wic3RhcnRcIjogMi41LCBcImVuZFwiOiA0LjAsIFwidGV4dFwiOiBcIkRpc2NvdW50cyBsb3Zlcj9cIn0sXG4gIHtcInN0YXJ0XCI6IDQuMCwgXCJlbmRcIjogNy4wLCBcInRleHRcIjogXCJTYXRpc2Z5IHlvdXIgZmllcmNlIHBpenphIGNyYXZpbmchXCJ9LFxuICB7XCJzdGFydFwiOiA4LjAsIFwiZW5kXCI6IDEwLjUsIFwidGV4dFwiOiBcIkdsb3ZvLiBZb3Ugb3JkZXIsIHdlIGRlbGl2ZXIuXCJ9XG5dIiwgInRhcmdldF9nZW5kZXIiOiAiZmVtYWxlIiwgInZvaWNlX3Byb3ZpZGVyIjogIkdvb2dsZSIsICJjbG9uZV9vcmlnaW5hbF92b2ljZXMiOiAiRmFsc2UiLCAicHJlZmVycmVkX3ZvaWNlX2ZhbWlseSI6ICJbXSIsICJ2b2ljZXMiOiAie1xuXCJlbi1VU1wiOiBbXCJlbi1VUy1OZXVyYWwyLUhcIiwgXCJlbi1VUy1OZXVyYWwyLUlcIixcImVuLVVTLU5ldXJhbDItSFwiLCBcImVuLVVTLU5ldXJhbDItSVwiXSxcblwiZW4tR0JcIjogW1wiZW4tR0ItTmV1cmFsMi1DXCIsIFwiZW4tR0ItTmV1cmFsMi1CXCIsXCJlbi1HQi1OZXVyYWwyLUNcIiwgXCJlbi1HQi1OZXVyYWwyLUJcIl0sXG5cImVzLUVTXCI6IFtcImVzLUVTLVBvbHlnbG90LTFcIixcImVzLUVTLU5ldXJhbDItQ1wiLFwiZXMtRVMtUG9seWdsb3QtMVwiLFwiZXMtRVMtTmV1cmFsMi1DXCJdXG59XG4iLCAib3V0cHV0X25hbWluZ19jb252ZW50aW9uIjogIm91dHB1dC8yMzA5MjAyNC97Y2FtcGFpZ25fbmFtZX0te2N1c3RvbV90YWd9LWZyb20te29yaWdpbmFsX2xhbmd1YWdlfS10by17dGFyZ2V0X2xhbmd1YWdlfSIsICJvdXRwdXRfYnVja2V0IjogIm15LWFyaWVsLWJ1Y2tldCIsICJzdGF0dXMiOiAiIiwgIm91dHB1dF9maWxlX3BhdGgiOiAiIiwgIm51bWJlcl9vZl9zcGVha2VycyI6ICIxIiwgImRpYXJpemF0aW9uX2luc3RydWN0aW9ucyI6ICIiLCAidHJhbnNsYXRpb25faW5zdHJ1Y3Rpb25zIjogIiIsICJub19kdWJiaW5nX3BocmFzZXMiOiAiW10iLCAibWVyZ2VfdXR0ZXJhbmNlcyI6ICJUcnVlIiwgIm1pbmltdW1fbWVyZ2VfdGhyZXNob2xkIjogIjAuMDAxIiwgImFkanVzdF9zcGVlZCI6ICJUcnVlIiwgInZvY2Fsc192b2x1bWVfYWRqdXN0bWVudCI6ICI1LjAiLCAiYmFja2dyb3VuZF92b2x1bWVfYWRqdXN0bWVudCI6ICIwLjAiLCAiZ2VtaW5pX21vZGVsX25hbWUiOiAiZ2VtaW5pLTEuNS1mbGFzaCIsICJnZW1pbmlfdGVtcGVyYXR1cmUiOiAiMS4wIiwgImdlbWluaV90b3BfcCI6ICIwLjk1IiwgImdlbWluaV90b3BfayI6ICI2NCIsICJnZW1pbmlfbWF4aW11bV9vdXRwdXRfdG9rZW5zIjogIjgxOTIiLCAiY2xlYW5fdXAiOiAiRmFsc2UiLCAid2l0aF92ZXJpZmljYXRpb24iOiAiRmFsc2UiLCAidHRzX3BhcmFtcyI6ICJ7XG4gICAgXCJwaXRjaFwiOiAwLjAsIFwic3BlZWRcIjogMS4wLCBcInZvbHVtZV9nYWluX2RiXCI6IDEwLjBcbn0iLCAicm93X251bSI6IDB9LCAidG9vbF9jb25maWciOiB7IlBST0NFU1NJTkdfRU5EX1BPSU5UX1VSTCI6ICJodHRwczovL3VzLWNlbnRyYWwxLWNvcHljYXQtaGVjdG9yLmNsb3VkZnVuY3Rpb25zLm5ldC9hcmllbC1zcGxpdHRlciIsICJTRVJWSUNFX0FDQ09VTlQiOiAiYXJpZWwtc2FAY29weWNhdC1oZWN0b3IuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCAiSFVHR0lOR19GQUNFX0FDQ0VTU19UT0tFTiI6ICJoZl9Qa1RXakFFTm1HYmp4T1VJdHlpZmJKTEFqQnBRSHFJR2RuIiwgIkFJX1NUVURJT19BUElfS0VZIjogIkFJemFTeUEzS1lkdmNqdEE1bjlSck9sLWdfZUR0ekJWVjJtVDJjdyIsICJFTEVWRU5fTEFCU19BUElfS0VZIjogInNrXzE3YTkwZDgwOTYzZDMxYTBiMGMyZWE1NGU4ZWI1NTkxYjNhMmI1YzgxYWMwZWUyYyIsICJEVUJCSU5HX0NPTkZJRyI6ICJkdWJiaW5nX2NvbmZpZyJ9LCAic3RhdHVzX2NvbHVtbnMiOiB7IlNUQVRVU19DT0xVTU4iOiAiUCIsICJVUERBVEVEX0FUX0NPTFVNTiI6ICJRIiwgIk1FU1NBR0VfQ09MVU1OIjogIlIifX0="
          }
      }'


